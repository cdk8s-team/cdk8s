#!/bin/bash
set -euo pipefail
scriptdir="$(cd $(dirname $0) && cd $(dirname $(readlink $0 || echo ".")) && pwd)"
subcommand=${1:-}
subcommands=$(cd ${scriptdir} && ls -1F cdk8s-*  | grep "*$" | sed -e 's/^cdk8s-//g' | sed -e 's/*$//g' | xargs)

if [ -z "${subcommand}" ]; then
  echo "usage: cdk8s SUBCOMMAND"
  echo "available subcommands: ${subcommands}"
  exit 1
fi

prog="${scriptdir}/cdk8s-${subcommand}"

if [ ! -x "${prog}" ]; then
  echo "unknown subcommand '${subcommand}'. available subcommands: ${subcommands}"
  exit 1
fi

shift
exec ${prog} $@